<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù…ØªØ¬Ø± Ø§Ù„Ø­Ø¯Ø« Ù…ÙˆØ¨Ø§ÙŠÙ„</title>
<style>
  :root{ --bg:#f7f9fc; --card:#fff; --text:#1f2937; --muted:#6b7280;
         --primary:#2563eb; --primary-600:#1d4ed8; --accent:#10b981;
         --danger:#ef4444; --border:#e5e7eb; --chip:#f1f5f9; --badge:#eef2ff;
         --shadow:0 6px 20px rgba(17,24,39,.08); --radius:14px;}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:"Segoe UI",Tahoma,Arial,sans-serif}
  header{position:sticky;top:0;z-index:60;background:#fff;box-shadow:var(--shadow)}
  .topbar{max-width:1200px;margin:auto;display:flex;gap:12px;align-items:center;padding:14px 16px}
  .brand{font-weight:800;letter-spacing:.3px;font-size:20px;background:linear-gradient(90deg,var(--primary),#7c3aed);
         -webkit-background-clip:text;background-clip:text;color:transparent}
  .search{flex:1} .search input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font-size:15px;background:#fff}
  .cart-btn{position:relative;background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  .cart-badge{position:absolute;top:-8px;left:-8px;background:var(--danger);color:#fff;font-size:12px;line-height:1;padding:5px 7px;border-radius:999px;min-width:22px;text-align:center}

  /* Tabs */
  .tabs{max-width:1200px;margin:10px auto 0;padding:0 16px 8px}
  .tab-list{display:flex;gap:10px;flex-wrap:wrap;background:#fff;padding:10px;border-radius:12px;border:1px solid var(--border)}
  .tab{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--chip);cursor:pointer;font-weight:600;color:#334155}
  .tab.active{border-color:var(--primary);background:var(--badge);color:var(--primary-600)}

  /* Brand bar */
  .brandbar{max-width:1200px;margin:6px auto 0;padding:0 16px 12px}
  .brand-list{display:flex;gap:10px;flex-wrap:wrap;background:#fff;padding:10px;border-radius:12px;border:1px solid var(--border)}
  .brand-btn{display:flex;align-items:center;gap:6px;padding:10px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:700;color:#1f2937;transition:transform .06s ease}
  .brand-btn .en{font-size:12px;color:#475569} .brand-btn.active{border-color:var(--primary);background:var(--badge);color:var(--primary-600)}
  .brand-btn:active{transform:scale(.98)}

  /* Slider */
  .slider-wrap{max-width:1200px;margin:10px auto;padding:0 16px}
  .slider{position:relative;border-radius:14px;overflow:hidden;box-shadow:var(--shadow);background:#111}
  .slides{display:flex;transition:transform .6s ease}
  .slide{min-width:100%;aspect-ratio:16/6}
  .slide img{width:100%;height:100%;object-fit:cover;display:block}
  .dots{position:absolute;bottom:10px;left:0;right:0;display:flex;gap:6px;justify-content:center}
  .dot{width:10px;height:10px;border-radius:999px;background:#ffffff88;cursor:pointer}
  .dot.active{background:#fff}
  .nav{position:absolute;top:50%;transform:translateY(-50%);background:#0008;color:#fff;border:none;width:36px;height:36px;border-radius:999px;cursor:pointer}
  .prev{left:8px} .next{right:8px}

  /* Grid */
  .grid{max-width:1200px;margin:12px auto 20px;padding:0 16px;display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
  .thumb{width:100%;aspect-ratio:4/3;background:#f3f4f6;display:flex;align-items:center;justify-content:center}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .content{padding:14px 14px 8px;display:flex;flex-direction:column;gap:10px;flex:1}
  .title{font-weight:700;font-size:16px}
  .prices{display:flex;align-items:center;gap:10px}
  .price-now{font-weight:800;color:var(--accent);font-size:18px}
  .price-old{color:var(--muted);text-decoration:line-through;font-size:14px}
  .badge-off{margin-inline-start:auto;background:var(--badge);color:#4338ca;font-weight:700;padding:6px 10px;border-radius:999px;font-size:12px}
  .specs{background:#f8fafc;border:1px dashed var(--border);border-radius:12px;padding:10px;color:#334155;min-height:64px;white-space:pre-line}
  .colors{display:flex;gap:8px;align-items:center} .swatch{width:28px;height:28px;border-radius:999px;border:2px solid #fff;box-shadow:0 0 0 2px var(--border);cursor:pointer}
  .swatch.active{box-shadow:0 0 0 2px var(--primary)}
  .actions{display:flex;gap:10px;margin-top:auto}
  .btn{flex:1;background:var(--primary);color:#fff;border:none;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.outline{background:#fff;color:var(--primary);border:1px solid var(--primary)}

  /* Drawer */
  .drawer{position:fixed;inset:0;display:none;background:rgba(15,23,42,.45);align-items:center;justify-content:center;padding:16px;z-index:100}
  .drawer.open{display:flex}
  .panel{width:min(1000px,96vw);max-height:90vh;background:#fff;border-radius:16px;overflow:hidden;box-shadow:var(--shadow);display:grid;grid-template-columns:1.1fr .9fr;min-height:420px}
  @media (max-width:900px){.panel{width:96vw;grid-template-columns:1fr}}
  .panel section{padding:16px} .panel h3{margin:0 0 12px}
  .cart-list{display:flex;flex-direction:column;gap:12px;max-height:55vh;overflow:auto;scroll-behavior:smooth}
  .cart-item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:10px}
  .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
  .qty{display:flex;align-items:center;gap:8px} .qty button{width:28px;height:28px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer}
  .total{margin-top:10px;display:flex;justify-content:space-between;font-weight:800}
  .form-grid{display:grid;gap:10px;grid-template-columns:1fr 1fr} .form-grid .full{grid-column:1/-1}
  input,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font-size:14px;background:#fff} textarea{min-height:90px;resize:vertical}
  footer{max-width:1200px;margin:30px auto;padding:16px;color:#6b7280;text-align:center}

  /* recent orders */
  .recent{max-width:1200px;margin:0 auto 24px;padding:0 16px}
  .recent .box{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
  .recent h3{margin:0 0 8px}
  .order{padding:10px;border:1px dashed var(--border);border-radius:10px;margin:6px 0}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand">Ù…ØªØ¬Ø± Ø§Ù„Ø­Ø¯Ø« Ù…ÙˆØ¨Ø§ÙŠÙ„</div>
    <div class="search"><input id="search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù‡Ø§Ø²â€¦" /></div>
    <button class="cart-btn" id="openCart">Ø§Ù„Ø³Ù„Ø© <span class="cart-badge" id="cartCount">0</span></button>
  </div>
  <div class="tabs">
    <div class="tab-list">
      <button class="tab active" data-tab="phones">Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©</button>
      <button class="tab" data-tab="tablets">Ø£Ø¬Ù‡Ø²Ø© Ù„ÙˆØ­ÙŠØ©</button>
      <button class="tab" data-tab="accessories">Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</button>
    </div>
  </div>
  <div class="brandbar">
    <div class="brand-list">
      <button class="brand-btn active" data-brand="all"><span class="en">All</span><span>Ø§Ù„ÙƒÙ„</span></button>
      <button class="brand-btn" data-brand="samsung"><span class="en">Samsung</span><span>Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬</span></button>
      <button class="brand-btn" data-brand="tecno"><span class="en">Tecno</span><span>ØªÙƒÙ†Ùˆ</span></button>
      <button class="brand-btn" data-brand="honor"><span class="en">Honor</span><span>Ù‡ÙˆÙ†Ø±</span></button>
      <button class="brand-btn" data-brand="apple"><span class="en">iPhone</span><span>Ø§ÙŠÙÙˆÙ†</span></button>
      <button class="brand-btn" data-brand="infinix"><span class="en">Infinix</span><span>Ø§Ù†ÙÙ†ÙƒØ³</span></button>
      <button class="brand-btn" data-brand="xiaomi"><span class="en">Redmi / Mi</span><span>Ø´Ø§ÙˆÙ…ÙŠ</span></button>
      <button class="brand-btn" data-brand="accessories"><span class="en">Accessories</span><span>Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</span></button>
    </div>
  </div>
</header>

<!-- Slider (Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©) -->
<div class="slider-wrap">
  <div class="slider" id="hero">
    <div class="slides">
      <div class="slide"><img src="images/slider1.jpg" alt="Ø¹Ø±Ø¶ 1"></div>
      <div class="slide"><img src="images/slider2.jpg" alt="Ø¹Ø±Ø¶ 2"></div>
      <div class="slide"><img src="images/slider3.jpg" alt="Ø¹Ø±Ø¶ 3"></div>
    </div>
    <button class="nav prev">â€¹</button>
    <button class="nav next">â€º</button>
    <div class="dots"></div>
  </div>
</div>

<main>
  <div class="grid" id="productGrid"></div>
</main>

<!-- Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
<section class="recent">
  <div class="box">
    <h3>ğŸ§¾ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
    <div id="recentOrders"></div>
  </div>
</section>

<!-- CART / CHECKOUT -->
<div class="drawer" id="cartDrawer" aria-hidden="true">
  <div class="panel" role="dialog" aria-label="Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª">
    <section style="border-inline-end:1px solid var(--border)">
      <h3>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
      <div class="cart-list" id="cartList"></div>
      <div class="total"><div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div id="cartTotal">0 JD</div></div>
    </section>
    <section id="checkoutSection">
      <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
      <div class="form-grid">
        <div><input id="buyerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" /></div>
        <div><input id="buyerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" /></div>
        <div class="full"><input id="buyerAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ØªÙØµÙŠÙ„ÙŠ)" /></div>
        <div class="full"><textarea id="buyerNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea></div>
      </div>
      <div class="form-grid" style="margin-top:10px">
        <button class="btn outline" id="downloadPDF">ØªÙ†Ø²ÙŠÙ„ PDF</button>
        <button class="btn" id="submitOrder">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </section>
  </div>
</div>

<footer>Â© <span id="year"></span> Ø§Ù„Ø­Ø¯Ø« Ù…ÙˆØ¨Ø§ÙŠÙ„ â€” Ø¬ÙˆØ¯Ø©ØŒ Ø«Ù‚Ø©ØŒ Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§ÙØ³Ø©</footer>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
/* ===== Ù…Ù†ØªØ¬Ø§Øª (brand + tab) ===== */
const PRODUCTS=[
  {id:"a06-64",tab:"phones",brand:"samsung",name:"Samsung A06 â€” 64GB / 4GB RAM",img:"images/samsung-A06.jpg",priceNow:49,priceOld:59,specs:"Ø´Ø§Ø´Ø© 6.5\" | ÙƒØ§Ù…ÙŠØ±Ø§ 50MP | Ø¨Ø·Ø§Ø±ÙŠØ© 5000mAh",colors:["#111827","#d1d5db","#9ca3af"]},
  {id:"a16-128",tab:"phones",brand:"samsung",name:"Samsung A16 â€” 128GB / 4GB RAM",img:"images/samsung-A16.jpg",priceNow:99,priceOld:115,specs:"Ø´Ø§Ø´Ø© 6.6\" 90Hz | ÙƒØ§Ù…ÙŠØ±Ø§ 50MP | Ø¨Ø·Ø§Ø±ÙŠØ© 5000mAh",colors:["#0f172a","#94a3b8","#e2e8f0"]},
  {id:"honor-x9b",tab:"phones",brand:"honor",name:"Honor X9b â€” 256GB",img:"images/honor-x9b.jpg",priceNow:299,priceOld:329,specs:"Ø´Ø§Ø´Ø© OLED | Ø¨Ø·Ø§Ø±ÙŠØ© Ù‚ÙˆÙŠØ©",colors:["#0f172a","#f59e0b","#e5e7eb"]},
  {id:"tecno-pova6",tab:"phones",brand:"tecno",name:"Tecno Pova 6 â€” 256GB",img:"images/tecno-pova6.jpg",priceNow:189,priceOld:219,specs:"Ø´Ø§Ø´Ø© 6.8\" | Ø¨Ø·Ø§Ø±ÙŠØ© 6000mAh",colors:["#111827","#eab308","#e2e8f0"]},
  {id:"hot-50",tab:"phones",brand:"infinix",name:"Infinix Hot 50 â€” 256GB",img:"images/infinix-hot-50.jpg",priceNow:135,priceOld:159,specs:"Ø´Ø§Ø´Ø© 6.78\" 120Hz | Ø´Ø­Ù† Ø³Ø±ÙŠØ¹",colors:["#111827","#64748b","#94a3b8"]},
  {id:"mi-note14-256",tab:"phones",brand:"xiaomi",name:"Redmi Note 14 â€” 256GB",img:"images/mi-note-14.jpg",priceNow:149,priceOld:179,specs:"Ø´Ø§Ø´Ø© AMOLED | Ù…Ø¹Ø§Ù„Ø¬ Ù‚ÙˆÙŠ | Ø´Ø­Ù† Ø³Ø±ÙŠØ¹",colors:["#111827","#334155","#d4d4d4"]},
  {id:"iphone16pm-256",tab:"phones",brand:"apple",name:"iPhone 16 Pro Max â€” 256GB",img:"images/iphone-16-pro-max.jpg",priceNow:900,priceOld:980,specs:"Ø´Ø§Ø´Ø© Super Retina | ÙƒØ§Ù…ÙŠØ±Ø§Øª Pro | A18",colors:["#0f172a","#b45309","#e5e7eb"]},
  {id:"ipad-10gen-64",tab:"tablets",brand:"apple",name:"iPad 10th Gen â€” 64GB",img:"images/ipad-10th.jpg",priceNow:339,priceOld:379,specs:"Ø´Ø§Ø´Ø© 10.9\" | Apple Pencil | Ø£Ø¯Ø§Ø¡ Ù…ÙˆØ«ÙˆÙ‚",colors:["#1f2937","#60a5fa","#fde68a"]},
  {id:"cable-usb-c",tab:"accessories",brand:"accessories",name:"USB-C Cable â€” 1m",img:"images/usb-c-cable.jpg",priceNow:5,priceOld:7,specs:"ÙƒØ§Ø¨Ù„ Ø³Ø±ÙŠØ¹ 60W",colors:["#111827","#9ca3af","#e5e7eb"]},
  {id:"buds-basic",tab:"accessories",brand:"accessories",name:"TWS Buds Basic",img:"images/tws-buds.jpg",priceNow:19,priceOld:25,specs:"Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ«",colors:["#111827","#e5e7eb","#9ca3af"]}
];

/* ===== Ø¹Ù†Ø§ØµØ± ===== */
const grid=document.getElementById('productGrid'), search=document.getElementById('search');
const cartDrawer=document.getElementById('cartDrawer'), openCartBtn=document.getElementById('openCart');
const cartList=document.getElementById('cartList'), cartTotal=document.getElementById('cartTotal'), cartCount=document.getElementById('cartCount');
const submitOrderBtn=document.getElementById('submitOrder'), downloadBtn=document.getElementById('downloadPDF');
const recentBox=document.getElementById('recentOrders');

/* ===== ØªØ¨ÙˆÙŠØ¨Ø§Øª ===== */
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{ document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); activeTab=btn.dataset.tab; render(); });
});
let activeTab='phones';

/* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª ===== */
document.querySelectorAll('.brand-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{ document.querySelectorAll('.brand-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); activeBrand=btn.dataset.brand; render(); });
});
let activeBrand='all';

/* ===== Ø³Ù„Ø§ÙŠØ¯Ø± ===== */
(function(){ const slider=document.getElementById('hero'), slides=slider.querySelector('.slides'), dots=slider.querySelector('.dots');
  const n=slider.querySelectorAll('.slide').length; let i=0, t;
  for(let k=0;k<n;k++){const d=document.createElement('div');d.className='dot'+(k===0?' active':'');d.onclick=()=>go(k);dots.appendChild(d);}
  function go(x){i=x;slides.style.transform=`translateX(-${i*100}%)`;dots.querySelectorAll('.dot').forEach((d,idx)=>d.classList.toggle('active',idx===i)); reset();}
  function next(){go((i+1)%n);} function prev(){go((i-1+n)%n);} function reset(){clearInterval(t); t=setInterval(next,5000);}
  slider.querySelector('.next').onclick=next; slider.querySelector('.prev').onclick=prev; reset();
})();

/* ===== Ø³Ù„Ø© ===== */
const CART_KEY='hadath_cart_v1'; let cart=JSON.parse(localStorage.getItem(CART_KEY)||'[]'); window.cart=cart;
let cartMode='preview'; // preview: Ø¹Ø±Ø¶ Ù…Ø®ØªØµØ±ØŒ full: Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„
function applyCartMode(){ const section=document.getElementById('checkoutSection'); if(!section) return; section.style.display = (cartMode==='full')? '' : 'none'; }
function saveCart(){ localStorage.setItem(CART_KEY,JSON.stringify(cart)); updateCartUI(); }
function addToCart(item){
  const key=`${item.id}_${item.color}`; const ex=cart.find(x=>x.key===key);
  ex?ex.qty++:cart.push({...item,key,qty:1});
  saveCart();
  cartMode='preview'; applyCartMode(); cartDrawer.classList.add('open');
}
function removeFromCart(key){ cart=cart.filter(x=>x.key!==key); window.cart=cart; saveCart(); }
function changeQty(key,delta){ const it=cart.find(x=>x.key===key); if(!it)return; it.qty+=delta; if(it.qty<=0)removeFromCart(key); saveCart(); }
function updateCartUI(){
  cartCount.textContent=cart.reduce((a,b)=>a+b.qty,0);
  cartList.innerHTML='';
  if(cart.length===0){
    cartList.innerHTML = `<div style="text-align:center;color:#64748b;padding:18px;border:1px dashed var(--border);border-radius:12px;">ğŸ›’ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ù„Ø©</div>`;
  }else{
    cart.forEach(it=>{
      const row=document.createElement('div'); row.className='cart-item';
      row.innerHTML=`<img src="${it.img}" alt=""><div>
      <div style="font-weight:700">${it.name}</div>
      <div style="font-size:13px;color:#475569">Ø§Ù„Ù„ÙˆÙ†: <span style="display:inline-block;width:14px;height:14px;border-radius:999px;background:${it.color};vertical-align:middle;margin:0 6px 0 3px"></span> | ${it.specs}</div>
      <div class="prices" style="margin-top:6px"><span class="price-now">${it.priceNow} JD</span><span class="price-old">${it.priceOld} JD</span></div></div>
      <div class="qty"><button onclick="changeQty('${it.key}',-1)">âˆ’</button><div>${it.qty}</div><button onclick="changeQty('${it.key}',1)">+</button></div>`;
      cartList.appendChild(row);
    });
  }
  cartTotal.textContent = cart.reduce((a,b)=>a+b.priceNow*b.qty,0)+" JD";
}
updateCartUI();
document.getElementById('openCart').addEventListener('click',()=>{ cartMode='full'; applyCartMode(); cartDrawer.classList.add('open'); });
cartDrawer.addEventListener('click',(e)=>{ if(e.target===cartDrawer) cartDrawer.classList.remove('open'); });
applyCartMode();

/* ===== Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===== */
function productCard(p){
  const discount=Math.max(0,Math.round((1-p.priceNow/p.priceOld)*100));
  const colors=p.colors.map((c,i)=>`<button class="swatch ${i===0?'active':''}" style="background:${c}" data-color="${c}" aria-label="Ù„ÙˆÙ†"></button>`).join('');
  const el=document.createElement('article'); el.className='card';
  el.innerHTML=`<div class="thumb"><img src="${p.img}" alt="${p.name}" loading="lazy"></div>
  <div class="content"><div class="title">${p.name}</div>
  <div class="prices"><div class="price-now">${p.priceNow} JD</div><div class="price-old">${p.priceOld} JD</div><div class="badge-off">${discount}% Ø®ØµÙ…</div></div>
  <div class="specs">${p.specs}</div><div class="colors">${colors}</div>
  <div class="actions"><button class="btn outline" data-more>ØªÙØ§ØµÙŠÙ„</button><button class="btn" data-add>Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button></div></div>`;
  let selectedColor=p.colors[0];
  el.querySelectorAll('.swatch').forEach(sw=>sw.addEventListener('click',()=>{ el.querySelectorAll('.swatch').forEach(s=>s.classList.remove('active')); sw.classList.add('active'); selectedColor=sw.dataset.color; }));
  el.querySelector('[data-more]').addEventListener('click',()=>alert(`Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª:\n${p.specs}`));
  el.querySelector('[data-add]').addEventListener('click',()=>addToCart({id:p.id,name:p.name,img:p.img,priceNow:p.priceNow,priceOld:p.priceOld,specs:p.specs,color:selectedColor}));
  return el;
}
function render(){
  const q=search.value.trim().toLowerCase();
  const list=PRODUCTS
    .filter(p=>p.tab===activeTab)
    .filter(p=>activeBrand==='all' || p.brand===activeBrand || (activeBrand==='accessories' && p.tab==='accessories'))
    .filter(p=>!q || p.name.toLowerCase().includes(q));
  grid.innerHTML=''; list.forEach(p=>grid.appendChild(productCard(p)));
}
render(); search.addEventListener('input',render);

/* ===== Ø£ÙˆØ§Ù…Ø± Ø­Ø¯ÙŠØ«Ø© (LocalStorage) ===== */
const ORDERS_KEY='hadath_orders_v1';
function loadOrders(){ return JSON.parse(localStorage.getItem(ORDERS_KEY)||'[]'); }
function saveOrderSummary(summary){ const arr=loadOrders(); arr.unshift(summary); localStorage.setItem(ORDERS_KEY, JSON.stringify(arr.slice(0,5))); renderRecent(); }
function renderRecent(){ const arr=loadOrders(); const box=document.getElementById('recentOrders'); box.innerHTML = arr.length? '' : '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</div>';
  arr.forEach(o=>{ const d=document.createElement('div'); d.className='order'; d.textContent = `${new Date(o.t).toLocaleString('ar')} â€” ${o.name} â€” ${o.total} JD (${o.items} Ù…Ù†ØªØ¬)`; box.appendChild(d); });
}
renderRecent();

/* ===== PDF Ø³Ø±ÙŠØ¹ Ù…Ù† Ø§Ù„Ø³Ù„Ø© ===== */
downloadBtn.addEventListener('click', async ()=>{
  if(cart.length===0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
  const box=document.createElement('div'); box.style.background='#fff'; box.style.padding='16px'; box.innerHTML=`<h2>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</h2>`;
  cart.forEach((it,i)=>{ const p=document.createElement('div'); p.textContent=`${i+1}) ${it.name} x${it.qty} = ${it.qty*it.priceNow} JD`; box.appendChild(p); });
  const sum=cart.reduce((a,b)=>a+b.qty*b.priceNow,0); const s=document.createElement('div'); s.style.marginTop='10px'; s.innerHTML=`<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${sum} JD</b>`; box.appendChild(s);
  document.body.appendChild(box);
  const canvas=await html2canvas(box,{scale:2,background:'#fff'}); const imgData=canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf; const pdf=new jsPDF('p','mm','a4'); const w=210-20; const h=canvas.height*(w/canvas.width); pdf.addImage(imgData,'PNG',10,10,w,h); pdf.save('invoice.pdf');
  document.body.removeChild(box);
});

/* ===== Telegram proxy ===== */
const TELEGRAM_PROXY_URL="https://script.google.com/macros/s/AKfycby_rcjDShr6Za6HjwgehDz6A-_3tx3M5oD46F-UhPTPoXDH9IIo75jhyiX-est3EIE1/exec";

/* ===== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ===== */
submitOrderBtn.addEventListener('click', async ()=>{
  const name=document.getElementById('buyerName').value.trim();
  const phone=document.getElementById('buyerPhone').value.trim();
  const address=document.getElementById('buyerAddress').value.trim();
  const notes=document.getElementById('buyerNotes').value.trim();

  if (!Array.isArray(cart) || cart.length === 0) { alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©."); return; }
  if(!name||!phone){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ."); return; }

  const total=cart.reduce((a,b)=>a+b.priceNow*b.qty,0);
  const lines=["ğŸ›’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ø­Ø¯Ø« Ù…ÙˆØ¨Ø§ÙŠÙ„",`ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}`,`ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${phone}`,address?`ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}`:"",notes?`ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}`:"","","Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:"];
  cart.forEach((it,i)=>lines.push(`${i+1}) ${it.name} | Ø§Ù„Ù„ÙˆÙ†: ${it.color} | Ø§Ù„ÙƒÙ…ÙŠØ©: ${it.qty} | Ø§Ù„Ø³Ø¹Ø±: ${it.priceNow} JD`));
  lines.push("",`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} JD`);

  async function sendToTelegram(payload){
    try{ const res=await fetch(TELEGRAM_PROXY_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); return await res.json(); }
    catch(err){ console.error(err); return {ok:false,error:String(err)}; }
  }

  const resp=await sendToTelegram({message:lines.filter(Boolean).join('\n')});
  if(resp && resp.ok){ alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…"); saveOrderSummary({t:Date.now(),name,total,items:cart.reduce((a,b)=>a+b.qty,0)}); cart.length=0; saveCart(); cartDrawer.classList.remove('open'); }
  else{ alert("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âŒ"); console.error(resp); }
});

document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>
